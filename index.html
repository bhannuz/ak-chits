<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AK Chit Funds</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/dexie/dist/dexie.js"></script>
    <style>
        :root {
            --bg-dark: #050a18;
            --card-bg: #11192e;
            --accent-gold: #f39c12;
            --text-main: #ffffff;
            --text-dim: #8e9aaf;
        }

        body { 
            background-color: var(--bg-dark); 
            color: var(--text-main);
            font-family: 'Segoe UI', sans-serif;
            padding-bottom: 90px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #1c2641;
        }
        .logo { color: var(--accent-gold); font-weight: bold; font-size: 1.2rem; }

        /* Dashboard Stats boxes from your screenshot */
        .stat-box {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            border: 1px solid #1c2641;
        }
        .stat-num { font-size: 1.4rem; font-weight: bold; display: block; }
        .stat-label { font-size: 0.7rem; color: var(--text-dim); text-transform: uppercase; }

        /* The Big Orange "New Payment" style button */
        .btn-payment {
            background: linear-gradient(90deg, #f39c12, #e67e22);
            color: #000;
            border: none;
            border-radius: 15px;
            padding: 20px;
            width: 100%;
            font-weight: bold;
            margin: 20px 0;
            text-align: left;
        }

        .form-dark {
            background: var(--card-bg);
            border: 1px solid #1c2641;
            color: white;
            border-radius: 10px;
        }
        .form-dark:focus { background: #161f36; color: white; border-color: var(--accent-gold); box-shadow: none; }

        /* Bottom Nav */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: #0a1021;
            display: flex;
            justify-content: space-around;
            padding: 12px;
            border-top: 1px solid #1c2641;
            z-index: 1000;
        }
        .nav-item { text-align: center; color: var(--text-dim); font-size: 0.7rem; text-decoration: none; cursor: pointer; }
        .nav-item.active { color: var(--accent-gold); }
    </style>
</head>
<body>

<div class="container py-3">
    <div class="header mb-4">
        <div class="logo">üèÜ AK Chit Funds</div>
        <div>
            <span class="badge bg-dark text-warning border border-warning">ADMIN</span>
            <button class="btn btn-outline-danger btn-sm ms-2" style="font-size: 10px;">LOGOUT</button>
        </div>
    </div>

    <div class="row g-2 mb-4 text-center">
        <div class="col-4">
            <div class="stat-box">
                <span class="stat-num" id="memberCount">0</span>
                <span class="stat-label">Members</span>
            </div>
        </div>
        <div class="col-4">
            <div class="stat-box">
                <span class="stat-num" id="groupCount">0</span>
                <span class="stat-label">Groups</span>
            </div>
        </div>
        <div class="col-4">
            <div class="stat-box">
                <span class="stat-num text-success">‚Çπ0</span>
                <span class="stat-label">Today</span>
            </div>
        </div>
    </div>

    <button class="btn-payment" onclick="document.getElementById('addMemberSection').scrollIntoView()">
        <span style="font-size: 1.2rem;">üí≥ New Payment</span><br>
        <span style="font-size: 0.7rem; opacity: 0.8;">Record receipt for a member</span>
    </button>

    <div id="addGroupSection" class="p-3 mb-4" style="background: #11192e; border-radius: 15px; border: 1px dashed #f39c12;">
        <h6 class="text-warning mb-3">Group Master</h6>
        <div class="input-group">
            <input type="text" id="groupName" class="form-control form-dark" placeholder="e.g. Group A - 1L">
            <button class="btn btn-warning fw-bold" onclick="saveGroup()">Create</button>
        </div>
    </div>

    <div id="addMemberSection" class="p-3 mb-5" style="background: #11192e; border-radius: 15px;">
        <h6 class="text-warning mb-3">Add Member</h6>
        <input type="text" id="mName" class="form-control form-dark mb-2" placeholder="Full Name">
        <input type="text" id="mPhone" class="form-control form-dark mb-2" placeholder="Phone Number">
        <select id="mGroup" class="form-select form-dark mb-3">
            <option value="">-- Assign Group --</option>
        </select>
        <button class="btn btn-warning w-100 fw-bold" onclick="saveMember()">Add to Database</button>
    </div>
</div>

<div class="bottom-nav">
    <div class="nav-item active">üè†<br>Home</div>
    <div class="nav-item" onclick="alert('Group list coming soon!')">üìÅ<br>Groups</div>
    <div class="nav-item" onclick="exportToCSV()">üì•<br>Backup</div>
</div>

<script>
    // 1. Initialize DB with Versioning for Groups
    const db = new Dexie("AKChitFundsDB");
    db.version(1).stores({ 
        members: "++id, name, phone, groupId",
        groups: "++id, name" 
    });

    // 2. Save Functions
    async function saveGroup() {
        const name = document.getElementById('groupName').value;
        if (!name) return alert("Enter group name");
        await db.groups.add({ name });
        document.getElementById('groupName').value = '';
        updateUI();
    }

    async function saveMember() {
        const name = document.getElementById('mName').value;
        const phone = document.getElementById('mPhone').value;
        const groupId = document.getElementById('mGroup').value;
        if (!name || !phone) return alert("Fill Name and Phone");

        await db.members.add({ name, phone, groupId });
        document.getElementById('mName').value = '';
        document.getElementById('mPhone').value = '';
        updateUI();
    }

    // 3. UI Update Logic
    async function updateUI() {
        const mCount = await db.members.count();
        const gCount = await db.groups.count();
        document.getElementById('memberCount').innerText = mCount;
        document.getElementById('groupCount').innerText = gCount;

        // Populate Member Dropdown with groups
        const groups = await db.groups.toArray();
        const select = document.getElementById('mGroup');
        select.innerHTML = '<option value="">-- Assign Group --</option>' + 
            groups.map(g => `<option value="${g.id}">${g.name}</option>`).join('');
    }

    // 4. Excel Backup
    async function exportToCSV() {
        const members = await db.members.toArray();
        let csv = "Name,Phone,GroupID\n" + members.map(m => `${m.name},${m.phone},${m.groupId}`).join("\n");
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = "AK_Chit_Backup.csv";
        a.click();
    }

    updateUI();
</script>
</body>
</html>